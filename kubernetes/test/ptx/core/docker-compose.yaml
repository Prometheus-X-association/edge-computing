name: ptx-core
services:
  mongodb-sandbox:
    container_name: "mongodb-sandbox"
    image: ptx/mongodb:8.0.5-slim
    ports:
      - "27020:27017"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - core
    healthcheck:
      test: [ "CMD-SHELL", "curl -sSf http://localhost:27017 || exit 1" ]
      start_period: 30s
      start_interval: 3s
  mongo-seed:
    container_name: "mongodb-seed"
    image: ptx/mongo-seed:1.8.2-slim
    depends_on:
      mongodb-sandbox:
        condition: service_healthy
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - core
  contract:
    container_name: "contract"
    image: ptx-core/contract:1.8.2-slim
    ports:
      - "3001:8081"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - core
    depends_on:
      mongo-seed:
        condition: service_completed_successfully
  catalog:
    container_name: "catalog"
    image: ptx-core/catalog:1.8.2-slim
    ports:
      - "3002:8082"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - core
    depends_on:
      mongo-seed:
        condition: service_completed_successfully
  consent:
    container_name: "consent"
    image: ptx-core/consent:1.8.2-slim
    ports:
      - "3003:8083"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - core
    depends_on:
      mongo-seed:
        condition: service_completed_successfully
networks:
  core:
    external: false