name: pdc
services:
  connector:
    container_name: pdc-connector
    image: ptx/connector:1.8.2-slim
    #    restart: unless-stopped
    restart: no
    depends_on:
      - mongodb
      - catalog
    volumes:
      - './config.production.json:/usr/src/app/src/config.production.json'
      - './.env.production:/usr/src/app/.env.production'
    ports:
      - "3333:3000"
    environment:
      MONGO_URI: mongodb://pdc-mongodb:27017/dataspace-connector
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - internal
  mongodb:
    container_name: pdc-mongodb
#    image: ptx/mongodb:4.0.5-alpine
    image: ptx/mongodb:8.0.5-slim
    ports:
      - "27018:27017"
    extra_hosts:
      - "host.docker.internal:host-gateway"
    networks:
      - internal
      - ptx-core
  catalog:
    container_name: ptx-catalog
    image: ptx-core/catalog:1.8.2-slim
    ports:
      - "3002:8082"
    networks:
      - ptx-core
    extra_hosts:
      - "host.docker.internal:host-gateway"
    healthcheck:
      # test: ["CMD-SHELL", "curl -sSf http://localhost:8082/__admin/health || exit 1"]
      test: [ "NONE" ]
networks:
  internal:
    external: false
  ptx-core:
    external: false