# PTX-Edge Extension Testing

## Overview

Testings of the PTX-Edge extension on the Kubernetes ecosystem is
fundamentally performed using the [Kind](https://kind.sigs.k8s.io/) tool.

However, during development testing tasks are conducted on different
levels described as follows.

- *Level 1*: Use a mock-up REST-API server based on an
             [OpenAPI specification](mock-api/swagger_server/swagger/swagger.yaml) 
             as a standalone Docker container to validate feature endpoints
             and basic data required

- *Level 2*: Use **Kind** -- a Kubernetes test deployment (based on Docker-in-Docker)
             -- to initiate a mock-up REST-API instance

- *Level 3*: Create a DiD test Kubernetes setup with basic PTX-EDGE features installed,
             where REST-API entrypoints are served by a standalone API component (based
             on its own autogenerated [openapi.json](../src/rest-api/spec/openapi.yaml))
             initiated in an internal pod (DiD)

- *Level 4*: Create test Kubernetes setup where the API endpoints are served by an internal
             component connected to the designed PTX K8s controller based on the same
             OpenAPI specification

> [!IMPORTANT]
>
> The current setup creates a test environment based on the predefined **Level 1**.

## Preparation and Setup

The test environment can be configured with the enclosed [Makefile](Makefile).

To install the test dependencies, execute the following command
```bash
make install
```

To configure and set up the test environment, execute the following command
```bash
make run
```

To tear down the test environment, use
```bash
make cleanup
```

The detailed description of the test environment is described below.

## Test Environment

The test environment can be set up locally based on Ubuntu 22.04 LTS by
cloning the repository and executing the following script.
```bash
$ git clone https://github.com/Prometheus-X-association/edge-computing.git
$ cd kubernetes/test
$ ./setup_kind_test_env.sh
```
The script installs the required dependencies
- [Docker](https://get.docker.com/) (latest)
- [Kind](https://github.com/kubernetes-sigs/kind/releases/tag/v0.24.0) (v0.26.0)
- [Kubectl](https://github.com/kubernetes/kubectl/releases/tag/v0.31.0) (v1.32.0)

and performs a simple test deployment on a temporary Kubernetes
cluster for validation.

The setup script also supports a rootless installation by using
the `-r` flag.
```bash
./setup_kind_test_env.sh -r
```
See more about rootless mode and its limitations in
[here](https://docs.docker.com/engine/security/rootless/)
and [here](https://kind.sigs.k8s.io/docs/user/rootless/).

Other configuration parameters are

- disabling the test deployment of a basic container at the end of the setup script
```bash
./setup_kind_test_env.sh -x
```
- and performing a minimal installation for production environments (e.g. no bash completions)
```bash
./setup_kind_test_env.sh -s
```

## Extension Installation

TBD

## Unit Tests

TBD

## REST-API Mockup

The repository also provides a mockup REST-API under `mock-api` folder
for testing purposes based on its 
[OpenAPI3.0 specification](mock-api/swagger_server/swagger/swagger.yaml).

See further the related [README.md](mock-api/README.md).
