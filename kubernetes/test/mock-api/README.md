# Swagger generated mock REST-API server

## Overview

This server was generated by the [swagger-codegen](https://github.com/swagger-api/swagger-codegen) project. By using the
[OpenAPI-Spec](https://github.com/swagger-api/swagger-core/wiki) from a remote server, you can easily generate a server
stub. This
is an example of building a swagger-enabled Flask server.

This example uses the [Connexion](https://github.com/zalando/connexion) library on top of Flask.

## Requirements

Python 3.5.2+ (~= Python 3.8.20)

## Preparations

Downgrade required packages regarding Python3.8 using the following requirement files:

```pycon
# requirements.txt
flask==1.1.4
markupsafe==2.0.1
connexion>=2.6.0,<3.0
connexion[swagger-ui]>=2.6.0,<3.0
```

```pycon
# test-requirements.txt
flask==1.1.4
markupsafe==2.0.1
#werkzeug<2.0.3
#jinja2<3.1.0
#itsdangerous<2.1.0
```

> [!CAUTION]
>
> The downgraded packages are obsolete and may contain vulnerability issues!
> The mock server should be used only for testing purposes.

## Virtual Environment Setup

Create a virtual environment using the following commands:

```bash
$ python3.8 -m pip install venv
$ python3.8 -m venv .venv
$ source .venv/bin/activate

(.venv) $ python3.8 -m pip install -U -r requirements.txt -r test-requirements.txt
```

## Usage

To run the mock server, please execute the following from the root directory:

```bash
(.venv) $ python3.8 -m swagger_server
```

Example output:

```bash
$ python3.8 -m swagger_server
 * Serving Flask app "__main__" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
 * Running on http://0.0.0.0:8080/ (Press CTRL+C to quit)
```

and open your browser to here for the API documentation:

```
http://localhost:8080/ptx-edge/v1/ui/
```

Your OpenAPI definition lives here:

```
http://localhost:8080/ptx-edge/v1/openapi.json
```

## Testing the endpoints

To prepare the unit test of REST-API endpoints, install tox:

```bash
$ python3.8 -m pip install tox
```

and launch it:

```bash
$ tox
```

Example output:

```bash
$ tox
GLOB sdist-make: /home/czentye/projects/PTX-edge-computing/kubernetes/test/mock-api/setup.py
py38 inst-nodeps: /home/czentye/projects/PTX-edge-computing/kubernetes/test/mock-api/.tox/.tmp/package/1/swagger_server-1.0.0.zip
py38 installed: attrs==25.1.0,certifi==2024.12.14,charset-normalizer==3.4.1,click==7.1.2,clickclick==20.10.2,connexion==2.14.2,coverage==7.6.1,distlib==0.3.9,filelock==3.16.1,Flask==1.1.4,Flask-Testing==0.8.0,idna==3.10,importlib_resources==6.4.5,inflection==0.5.1,itsdangerous==1.1.0,Jinja2==2.11.3,jsonschema==4.23.0,jsonschema-specifications==2023.12.1,MarkupSafe==2.0.1,nose==1.3.7,packaging==24.2,pkgutil_resolve_name==1.3.10,platformdirs==4.3.6,pluggy==1.5.0,py==1.11.0,python-dateutil==2.6.0,PyYAML==6.0.2,randomize==0.14,referencing==0.35.1,requests==2.32.3,rpds-py==0.20.1,six==1.17.0,swagger-ui-bundle==0.0.9,swagger_server @ file:///home/czentye/projects/PTX-edge-computing/kubernetes/test/mock-api/.tox/.tmp/package/1/swagger_server-1.0.0.zip#sha256=5149ea483f09c5ee9e95ce9d1c7553d8c7f450aba5cc1bfbcc3bd434da745f9f,toml==0.10.2,tox==3.20.1,urllib3==2.2.3,virtualenv==20.29.1,Werkzeug==1.0.1,zipp==3.20.2
py38 run-test-pre: PYTHONHASHSEED='274862753'
py38 run-test: commands[0] | nosetests -v
Test case for checking available live API: HTTP 200 ... ok
Test case for valid   request_edge_proc request: HTTP 200 ... ok
Test case for invalid request_edge_proc request: HTTP 400 ... ok
Test case for invalid request_edge_proc request: HTTP 403 ... ok
Test case for invalid request_edge_proc request: HTTP 404 ... ok
Test case for invalid request_edge_proc request: HTTP 408 ... ok
Test case for invalid request_edge_proc request: HTTP 412 ... ok
Test case for invalid request_edge_proc request: HTTP 503 ... ok
Test case for valid   request_privacy_edge_proc request: HTTP 200 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 400 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 401 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 403 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 404 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 408 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 412 ... ok
Test case for invalid request_privacy_edge_proc request: HTTP 503 ... ok
Test case for valid   get_version response: HTTP 200 ... ok

----------------------------------------------------------------------
Ran 17 tests in 2.329s

OK
_____________________________________________________________________________________________________ summary _____________________________________________________________________________________________________
  py38: commands succeeded
  congratulations :)
```

For manually executing the test cases defined in
[test_customer_api_controller.py](swagger_server/test/test_customer_api_controller.py)
and
[test_default_controller.py](swagger_server/test/test_default_controller.py),
run the following command from the root directory:

```bash
$ nosetests -v
```

or with stdout capturing:

```bash
$ nosetests -v -s
```

For dumping the request/response bodies generated by test cases of a
given test controller, e.g.,
[test_customer_api_controller.py](swagger_server/test/test_customer_api_controller.py),
use the following command:

```bash
$ nosetests -v --debug=TestCustomerAPIController
```

## Running with Docker

To run the server on a Docker container, please execute the following from the mockup root directory:

```bash
# Building the image
$ docker build -t ptx-edge-api:0.1 .

# Starting up a container
$ docker run --rm --name ptx-edge-api -p 8080:8080 -it ptx-edge-api:0.1
INFO:__main__:The API documentation is available on http://localhost:8080/ptx-edge/v1/ui/
 * Serving Flask app "__main__" (lazy loading)
 * Environment: production
   WARNING: This is a development server. Do not use it in a production deployment.
   Use a production WSGI server instead.
 * Debug mode: off
INFO:werkzeug: * Running on http://0.0.0.0:8080/ (Press CTRL+C to quit)
INFO:werkzeug:172.17.0.1 - - [10/Feb/2025 16:22:17] "HEAD /ptx-edge/v1/ui/ HTTP/1.1" 200 -


# Testing the API
$ curl -I http://127.0.0.1:8080/ptx-edge/v1/ui/
HTTP/1.0 200 OK
Content-Type: text/html; charset=utf-8
Content-Length: 1493
Server: Werkzeug/1.0.1 Python/3.8.20
Date: Mon, 10 Feb 2025 16:22:17 GMT
```